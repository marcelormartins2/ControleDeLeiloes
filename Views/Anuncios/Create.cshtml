@model ControleDeLeiloes.Models.Anuncio

@{
    ViewData["Title"] = "Create";
}

        <div class="panel panel-default plain toggle panelMove panelClose panelRefresh">
            <!-- Start .panel -->
            <div class="panel-heading">
                <h4 class="panel-title">Stripped progressbars</h4>
            </div>
            <div class="panel-body">
                <form asp-action="Create">
                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                    <div class="form-group">
                        <input id="btnAtualizar" type="submit" value="Atualizar Anuncios" class="btn btn-primary mr5 mb10" />
                    </div>
                </form>
                <form action="#" class="form-horizontal">
                    <div class="form-group">
                        <label class="col-lg-3 control-label">Atualizando</label>
                        <div class="col-lg-10">
                            <div class="progress progress-striped">
                                <div id="progressbar" class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100" style="width: 50%;"></div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    

    <div>
        <a asp-action="Index">Back to List</a>
    </div>

    @section scripts
{

        <script type="text/javascript">
            $(window).load(function () {
                $('#btnAtualizar').on('click', function () {
                    timer = setInterval(function () {
                        GetProgress(timer);
                    }, 200);
                    //$.ajax({
                    //    url: "/Anuncios/Create",
                    //    type: "GET",
                    //    dataType: "JSON",
                    //    success: function (retorno) {
                    //        timer = setInterval(function () {
                    //            GetProgress(timer);
                    //        }, 2000);
                    //    }
                    //});
                })
            });
            function GetProgress(timer) {
                $.ajax({
                    type: 'GET',
                    url: '/Anuncios/GetProgress',
                    datatype: 'json',
                    success: function (progresso) {
                        if (progresso.etapa != 100) {
                            $('#progressbar').attr("style", "width: " + progresso.etapa +"%;"); 
                            $("#progressbar").html(progresso.etapa + "%");
                        }
                        else {
                            clearInterval(timer);
                        }
                    }
                });
            }
        </script>

    }
